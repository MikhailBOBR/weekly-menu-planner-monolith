## Weekly Menu Planner — единое локальное веб‑приложение

Веб‑приложение для автоматизированного составления **недельного плана питания** с учётом:

- пола, возраста, веса, роста и уровня активности;
- цели (похудение, поддержание веса, набор массы);
- типа диеты (обычная, веганская, кето и др.);
- количества приёмов пищи и наличия перекусов;
- исключаемых ингредиентов и дневных предпочтений (диета, кухня, ключевые слова по дням недели).

Один **Spring Boot** монолит:

- поднимает backend (REST API);
- раздаёт статические файлы фронта (`index.html` + `app.js`);
- использует встроенную **H2** БД (без Docker, Postgres, Node.js и т.п.);
- запускается и работает локально **одной командой**.

---

### 1. Основные возможности

- **Расчёт целевой суточной калорийности**  
  На основе параметров профиля и цели приложения вычисляет рекомендуемое количество калорий.

- **Автоматическая генерация недельного меню**  
  Сервис `MenuGeneratorService` распределяет калории по приёмам пищи (завтрак/обед/ужин/перекусы) и подбирает рецепты из базы.

- **Учёт ограничений и предпочтений**  
  - исключаемые ингредиенты (например, «орехи», «глютен», «свинина»);
  - отдельные предпочтения по дням недели: тип диеты, кухня, ключевые слова;
  - попытка избегать повторов блюд в рамках одной недели.

- **Удобный веб‑интерфейс**  
  - форма профиля и настроек;
  - карточки по дням недели с суммой калорий;
  - модальные окна с подробностями блюда;
  - тёмная/светлая тема;
  - небольшая система заметок, хранящихся в `localStorage`.

- **Полностью локальная работа**  
  Всё работает на одном компьютере: H2, backend и фронтенд поднимаются одним процессом Spring Boot.

---

### 2. Стек технологий

- **Backend**: Java 17, Spring Boot 3.2 (Spring Web, Spring Data JPA);
- **База данных**: H2 (in‑memory, конфигурируется через `application.properties`);
- **ORM**: JPA / Hibernate;
- **Сборка**: Maven;
- **Утилиты**: Lombok;
- **Frontend**: HTML5, CSS3, нативный JavaScript (`app.js`), без React/Vue/Node.

---

### 3. Требования

- **JDK**: 17+  
- **Maven**: 3.8+  
- **Браузер**: любой современный с поддержкой HTML5, CSS3 и ES6 (Chrome, Firefox, Edge, Safari и т.п.).

Интернет‑подключение не требуется: всё работает в оффлайне при локальном запуске.

---

### 4. Сборка и запуск

#### 4.1. Быстрый старт (режим разработки)

```bash
cd weekly-menu-planner
mvn spring-boot:run
```

После старта:

- открой в браузере: `http://localhost:8080`;
- UI загружается с корневого URL (`/`);
- backend‑API доступно по `http://localhost:8080/api/...`.

#### 4.2. Запуск из собранного JAR

```bash
cd weekly-menu-planner
mvn clean package
java -jar target/weekly-menu-planner-0.0.1-SNAPSHOT.jar
```

Порт по умолчанию — `8080` (можно изменить через `server.port` в `application.properties`).

---

### 5. Архитектура и структура проекта

#### 5.1. Пакеты backend’а

- `com.planner.MenuPlannerApplication` — точка входа Spring Boot.
- `com.planner.model`  
  - `Recipe` — сущность рецепта (таблица `recipes`);  
  - `MealType` — перечисление типов приёма пищи.
- `com.planner.dto`  
  - `MenuRequest` — входные параметры профиля и предпочтений;  
  - `DayPreference` — настройки по дням недели;  
  - `MenuPlanResponse` — результат генерации меню.
- `com.planner.repository`  
  - `RecipeRepository` — интерфейс Spring Data JPA для работы с рецептами.
- `com.planner.service`  
  - `MenuGeneratorService` — бизнес‑логика генерации недельного плана (калории, фильтры, выбор рецептов).
- `com.planner.controller`  
  - `MenuController` — REST‑эндпоинты `/api/recipes` и `/api/generate-plan`.
- `com.planner.config`  
  - `DataInitializer` — начальное заполнение таблицы рецептов.

#### 5.2. Ресурсы

- `src/main/resources/application.properties` — настройки H2, JPA, порта сервера.  
- `src/main/resources/static/index.html` — основная страница интерфейса.  
- `src/main/resources/static/app.js` — вся логика фронтенда (форма, fetch, рендер плана, темы, заметки).

---

### 6. База данных и инициализация

- Используется H2 **in‑memory** (по умолчанию):  
  `spring.datasource.url=jdbc:h2:mem:plannerdb;DB_CLOSE_DELAY=-1`
- Схема БД создаётся автоматически по JPA‑сущностям (`spring.jpa.hibernate.ddl-auto=update`).
- При старте приложения `DataInitializer` проверяет, есть ли уже записи в `recipes`; если нет, создаёт набор демонстрационных блюд разных типов диет и приёмов пищи.

Консоль H2 включена:

- URL: `http://localhost:8080/h2-console`
- JDBC URL: `jdbc:h2:mem:plannerdb`
- user: `sa`
- password: *(пусто)*

---

### 7. Фронтенд

Фронтенд лежит в `src/main/resources/static`:

- `index.html` — адаптивный интерфейс с:
  - формой профиля (пол, возраст, рост, вес, активность, цель, диета и т.д.);
  - полем недели (`weekId`) с автозаполнением текущей ISO‑недели;
  - блоком настроек по дням недели;
  - панелью статистики (целевые/фактические калории).
- `app.js` — отвечает за:
  - сбор данных формы и построение JSON‑запроса;
  - `POST /api/generate-plan` (персональный план) и обработку ответа;
  - рендер плана на неделю по дням и приёмам пищи;
  - открытие модальных окон с описанием блюда;
  - переключение темы (тёмная/светлая, хранится в `localStorage`);
  - простую систему заметок, также на `localStorage`.

Фреймворки (React/Vue/Angular) не используются — всё на ванильном JS.

---

### 8. REST API (кратко)

- **Рецепты**
  - `GET /api/recipes` — получить список всех рецептов;
  - `GET /api/recipes/{id}` — получить рецепт по ID;
  - `POST /api/recipes` — создать рецепт (в теле — JSON `Recipe`);
  - `PUT /api/recipes/{id}` — обновить рецепт;
  - `DELETE /api/recipes/{id}` — удалить рецепт.

- **Генерация меню**
  - `POST /api/generate-plan` — персональная генерация плана по полям `MenuRequest`:

```json
{
  "gender": "FEMALE",
  "age": 25,
  "height": 165,
  "weight": 60,
  "activity": "MODERATE",
  "goal": "MAINTAIN",
  "diet": "ALL",
  "mealsPerDay": 3,
  "includeSnack": true,
  "weekId": "2025-W10",
  "manualCalories": 1800,
  "excludedIngredients": ["свинина", "орехи"],
  "dayPreferences": []
}
```

  - `GET /api/generate-plan?diet=ALL&calories=2000` — упрощённый вариант: диета и целевые калории задаются через query‑параметры.

Ответ — объект `MenuPlanResponse` с картой день → список блюд и статистикой по калориям.

---

### 9. Автоматические тесты

Тесты лежат в `src/test/java` и запускаются командой:

```bash
mvn test
```

Покрыто:

- загрузка Spring‑контекста (`MenuPlannerApplicationTests`);
- сервис генерации меню (`MenuGeneratorServiceTest`):
  - базовая генерация плана;
  - проверка учёта `excludedIngredients`;
- REST‑контроллер (`MenuControllerTest`):
  - `GET /api/recipes`;
  - `POST /api/generate-plan`;
  - `GET /api/generate-plan` с query‑параметрами;
- репозиторий (`RecipeRepositoryTest`):
  - выборка по `MealType`;
  - фильтрация по диете и типу приёма пищи.

Все тесты максимально простые и устойчивые, ориентированы на демонстрацию работоспособности основных модулей.

---

### 10. Типовые проблемы и решения

- **Maven не найден / проект не собирается**  
  Проверь `mvn -version`, установи Maven и убедись, что он добавлен в `PATH`.

- **Ошибка версии Java**  
  Убедись, что используется JDK 17 (`java -version`, `javac -version`), а не более старая.

- **Страница по `http://localhost:8080` не открывается**  
  Проверь, что приложение запущено (команда `mvn spring-boot:run` не завершилась с ошибкой). Убедись, что порт 8080 свободен, или поменяй его в `application.properties`.

- **Не подгружается JS/стили**  
  Убедись, что `index.html` и `app.js` находятся в `src/main/resources/static` и что браузер не блокирует загрузку локальных скриптов (см. вкладку Network в DevTools).

- **Ошибка при генерации меню в UI**  
  Сообщение «Не получается собрать меню. Убедитесь, что backend запущен.» означает, что запрос к `/api/generate-plan` не удался. Проверь, что сервер работает и не упал с ошибкой в консоли Maven.

---

### 11. Как презентовать как курсовой/дипломный проект

- Показать архитектуру: **монолитное web‑приложение** на Spring Boot с разделением на слои Controller–Service–Repository и DTO.  
- Пояснить работу с данными: H2 + JPA (сущность `Recipe`, репозиторий `RecipeRepository`, инициализация в `DataInitializer`).  
- Продемонстрировать бизнес‑логику: `MenuGeneratorService` (расчёт калорий, распределение по приёмам пищи, фильтрация и ранжирование рецептов).  
- Показать REST API и фронтенд, работающий из того же приложения (один JAR/одна команда запуска).  
- Отдельно отметить наличие автоматических тестов (`mvn test`) и возможные направления развития:
  - добавление аутентификации и профилей пользователей (Spring Security);
  - сохранение и история меню по неделям;
  - расширенные алгоритмы планирования (ограничения по бюджету, составлению списка покупок и т.п.).

